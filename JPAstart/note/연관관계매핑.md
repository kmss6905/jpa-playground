#매핑관계

관계형 데이터베이스와 객체와는 큰 차이가 있다.
관계형 데이터베이스는 참조하는 것이 없다.
다시 말해 관계형 데이터 베이스에서 조인 관계의 두 테이블은 방향성이라는 것이 존재하지 않는다.  

Member
* ID ( PK )
* NAME
* TEAM_ID( FK )


Team
* ID ( PK )
* TEAM_NAME


만약 sql 에서 맴버 중 팀 이름이 "teamA"인
모든 맴버를 조회하려고 한다면?
```sql

select * from Member m
join Team t on m.ID = t.ID
where t.TEAM_NAME = 'teamA'

```

혹은
```sql

select * from Team t
join Member m on t.ID = t.ID

```
이렇게 얼마든지 외래키를 통해 탐색할 수 있다.
방향성이라는 것은 의미가 없다.

JPA 는 외래키의 존재를 모른다.
래퍼런스를 통한 탐색만 있을 뿐  
따라서 MappedBy 라는 속성을 이용하여 객체들간의 연관관계 주인을 명시해야한다.
즉, 둘중 하나로 외래키를 관리해야한다.

## 연관관계의 주인(Ownner)

---

### 양방향 매핑 규칙
* 객체의 두 관계중 하나를 연관관계의 주인으로 지정
* 연관관계의 주인만이 외래키를 관리(등록, 수정)  
* 주인이 아닌 쪽은 읽기만 가능
* 주인은 mappedBy 속성 사용 X
* 주인이 아니면 mappedBy 속성으로 주인 지정

### 누구를 주인으로?
* 외래 키가 있는 곳을 주인으로 정하자
* 여기서는 Member.team 이 연관관계의 주인
  
(.. 모 배달의 민족 실무 팁)
실제 설계는 단방향 매핑으로 설계를 모두 끝낸다.  
만약 개발 도중 양방향 매핑이 필요하다 싶으면
그때 양방향으로 뚫는다.. 


### 양방향 매핑시 가장 많이 하는 실수
(연관관계의 주인에 값을 입력하지 않음)
```java

Team team = new Team();
team.setName("TeamA");
em.persist(team);

Member member = new Member();
member.setName("member1");

// 역방향(주인이 아닌 방향)만 연관관계 설정
team.getMembers().add(member);
em.persist(member);


```

### (현업 팁) 양방향 매핑 시 연관관게의 주인에 값을 입력해야 한다. 
맴버에도 팀을 넣고 팀에도 맴버를 넣고 싶다?  
그러면 두 곳 모두 넣어주자. 
객체 관점에서는 둘다 넣어주자.

```java
Team team = new Team();
team.setName("TeamA");
em.persist(team);

Member member = new Member();
member.setName("member1");

// 역방향(주인이 아닌 방향)만 연관관계 설정
team.getMembers().add(member);
memver.setTeam(team); // 양쪽 다 세팅하는 것을 권장

em.persist(member);

```



